# UW-Logic

”UW-Logic“文档描述潜器主要工作模式的工作逻辑，包括任务流、命令流和信息流的实现与交互。

潜器的主要工作模式包括甲板自检模式、水面模式、水下运动模式、下潜模式。

## 一、甲板自检

### 1.1 甲板自检概述

甲板自检模式指潜器放置在甲板上，上电后进行各模块功能自检的模式。潜器上电后，潜器程序自动运行，主动执行甲板自检，依次对各部分关键模块进行上电自检，同时在主控终端的命令行显示自检信息并记录log，同时关键信息通过电台发送给甲板软件。

甲板自检顺序：

| 序号 | 名称          |
| ---- | ------------- |
| 1    | 主控程序      |
| 2    | 通讯电台      |
| 3    | 电池组        |
| 4    | 电控板（DAM） |
| 5    | IMU           |
| 6    | GPS           |
| 7    | 关节电机      |
| 8    | 主推进器      |
| 9    | ...           |



### 1.2 甲板自检流程

#### 1.主控程序功能自检

电池组上电后，潜器主控程序自动启动，进行程序自身初始化操作。

**自检项：**

① 日志记录功能；

② 主控硬件初始化；

③ 监控线程运行；

④ 守护进程工作情况；

⑤ 各继电器工作情况，包括继电器上下电情况、输出电流等。

#### 2.通讯电台自检

通讯电台继电器上电，检测电台继电器输出电流。

以1Hz频率发送甲板软件握手命令，等待回复，收到回复后表示与甲板软件建立电台通讯。

建立电台通讯后，向甲板软件发送主控各继电器工作信息。

自检项：

① 电台工作电流；

② 电台通讯；

#### 3.电池组自检

主控程序建立与电池组通讯，读取当前电池组电流、电压、剩余电量信息，进行电池组状态自检。

自检完成后，向甲板软件发送电池组自检完成信息。

**自检项：**

① 电池组串口通讯；

② 电池工作电压、电流；

③ 电池剩余电量；

#### 3.电控板自检

电控板(DAM)继电器上电，检测电控板继电器输出电流。

主控与电控板串口建立通讯连接，读取当前各数字IO口和模拟IO口的输出情况。

对空闲端口

自检完成后，向甲板软件发送电控板自检完成信息。

**自检项：**

① 电池组串口通讯；

② 电池工作电压、电流；

③ 电池剩余电量









